<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PLAY. CREATE. LIVE. â€” Edit Creators</title>

    <style>
        :root {
            --bg: #05060a;
            --card: #11131aee;
            --border: #ffffff20;
            --text: #eaeef6;
            --muted: #9aa3b2;
            --accent: #ffb457;
            --accent2: #ff8c37;
            --danger: #ff6b6b;
            --radius: 20px;
            --shadow: 0 10px 30px rgba(0, 0, 0, .35), inset 0 1px 0 rgba(255, 255, 255, .04);
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
        }

        body {
            margin: 0;
            font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans JP", sans-serif;
            color: var(--text);
            background: radial-gradient(circle at 0% 0%, #1f2937, #020617 60%);
            overflow-x: hidden;
        }

        header {
            padding: 18px 22px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .title {
            font-weight: 700;
            letter-spacing: .08em;
            font-size: 14px;
        }

        .lockstate {
            font-size: 12px;
            color: #ffd9b8;
            margin-left: 8px;
        }

        .back-link {
            text-decoration: none;
            font-size: 12px;
            color: #cbd5f5;
            padding: 8px 14px;
            border-radius: 999px;
            border: 1px solid var(--border);
            background: linear-gradient(135deg, #ffffff12, #ffffff03);
        }

        .back-link:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, .35);
        }

        .container {
            max-width: 1120px;
            margin: 0 auto;
            padding: 0 20px 40px;
            display: grid;
            grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
            gap: 20px;
        }

        @media(max-width:900px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        .glass {
            border-radius: var(--radius);
            background: linear-gradient(135deg, #ffffff0f, #ffffff03);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            padding: 16px 18px 18px;
        }

        h2 {
            font-size: 13px;
            letter-spacing: .1em;
            text-transform: uppercase;
            margin: 0 0 8px;
        }

        .hint {
            font-size: 12px;
            color: var(--muted);
            margin-bottom: 10px;
        }

        .dropzone {
            position: relative;
            border: 1px dashed #ffb45777;
            border-radius: 16px;
            padding: 18px;
            text-align: center;
            transition: .2s border-color, .2s background;
            background: linear-gradient(180deg, #ffb45715, transparent);
            margin-bottom: 10px;
        }

        .dropzone.dragover {
            border-color: #ffb457cc;
            background: linear-gradient(180deg, #ffb45722, transparent);
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        @media(max-width:640px) {
            .row {
                grid-template-columns: 1fr;
            }
        }

        label {
            font-size: 11px;
            color: #c8d0dc;
            letter-spacing: .06em;
            text-transform: uppercase;
        }

        input[type="text"],
        textarea {
            width: 100%;
            margin-top: 4px;
            padding: 9px 10px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: #020617cc;
            color: var(--text);
            font-size: 13px;
            outline: none;
            transition: border .2s, box-shadow .2s;
        }

        textarea {
            min-height: 70px;
            resize: vertical;
        }

        input:focus,
        textarea:focus {
            border-color: #ffb457aa;
            box-shadow: 0 0 0 3px #ffb45730;
        }

        .btns {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .btn {
            appearance: none;
            border-radius: 999px;
            border: 1px solid var(--border);
            background: linear-gradient(135deg, #ffffff22, #ffffff08);
            color: var(--text);
            padding: 8px 14px;
            font-size: 12px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn.primary {
            background: linear-gradient(135deg, #ffb457, #ff8c37);
            border: none;
            color: #111827;
            font-weight: 600;
        }

        .btn.danger {
            border-color: #ff6b6b77;
            background: linear-gradient(135deg, #ef444477, #b91c1c55);
            color: #fee2e2;
        }

        .btn:disabled {
            opacity: .5;
            cursor: not-allowed;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
            font-size: 12px;
        }

        thead {
            background: #020617cc;
        }

        th,
        td {
            padding: 6px 6px;
            border-bottom: 1px solid #1e293b;
        }

        th {
            text-align: left;
            font-weight: 500;
            color: #cbd5f5;
        }

        tr:hover td {
            background: #0b1220;
        }

        .badge-lock {
            font-size: 11px;
            color: #facc15;
        }

        /* LOGIN OVERLAY */
        .login-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .85);
            backdrop-filter: blur(14px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .login-card {
            width: min(360px, 90vw);
            border-radius: 20px;
            background: #0b1120ee;
            border: 1px solid #ffffff22;
            padding: 20px 22px 22px;
            box-shadow: 0 24px 60px rgba(0, 0, 0, .8);
        }

        .login-card h1 {
            margin: 0 0 8px;
            font-size: 18px;
            letter-spacing: .1em;
            text-transform: uppercase;
        }

        .login-card p {
            margin: 0 0 14px;
            font-size: 12px;
            color: #9ca3af;
        }

        .login-card label {
            display: block;
            font-size: 11px;
            letter-spacing: .06em;
            text-transform: uppercase;
            color: #cbd5f5;
            margin-top: 10px;
        }

        .login-card input {
            width: 100%;
            margin-top: 4px;
            padding: 9px 10px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: #020617;
            color: #e5e7eb;
            font-size: 13px;
            outline: none;
        }

        .login-card input:focus {
            border-color: #ffb457aa;
            box-shadow: 0 0 0 2px #ffb45733;
        }

        .login-card button {
            margin-top: 14px;
            width: 100%;
            padding: 9px 0;
            border-radius: 999px;
            border: none;
            background: linear-gradient(135deg, #ffb457, #ff8c37);
            color: #111827;
            font-weight: 600;
            cursor: pointer;
        }

        .login-error {
            font-size: 11px;
            color: #fecaca;
            margin-top: 8px;
        }
    </style>
</head>

<body>
    <!-- LOGIN -->
    <div id="loginOverlay" class="login-backdrop">
        <div class="login-card">
            <h1>EDIT PANEL</h1>
            <p>ç™»éŒ²ãƒ»ç·¨é›†ã«ã¯ç®¡ç†è€…IDã§ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚</p>
            <label for="loginEmail">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
            <input id="loginEmail" type="email" placeholder="admin@example.com" />
            <label for="loginPassword">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
            <input id="loginPassword" type="password" placeholder="password" />
            <button id="loginButton">ãƒ­ã‚°ã‚¤ãƒ³</button>
            <div id="loginError" class="login-error"></div>
        </div>
    </div>

    <header>
        <div>
            <span class="title">PLAY. CREATE. LIVE. â€” EDIT</span>
            <span class="lockstate" id="lockState">ğŸ”’ Locked</span>
        </div>
        <a href="index.html" class="back-link">â† Back to TOP</a>
    </header>

    <main class="container">
        <!-- FORM -->
        <section class="glass">
            <h2>CREATOR FORM</h2>
            <p class="hint">å‹•ç”»ã¨ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç™»éŒ²ã—ã¾ã™ã€‚ä¿å­˜ã¯Firebaseã«è¡Œã‚ã‚Œã€ã©ã®ç«¯æœ«ã‹ã‚‰ã§ã‚‚é–²è¦§ã§ãã¾ã™ã€‚ï¼ˆç·¨é›†ã¯ç®¡ç†è€…ã®ã¿ï¼‰</p>

            <div class="dropzone" id="videoDrop">
                <input id="videoInput" type="file" accept="video/*"
                    style="position:absolute;inset:0;opacity:0;cursor:pointer;">
                <div style="pointer-events:none">
                    <div style="font-size:32px">â¬†</div>
                    <div style="font-size:13px;margin-top:2px;">ã“ã“ã«ãƒ¡ã‚¤ãƒ³å‹•ç”»ã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div>
                    <div class="hint">MP4 / MOV ãƒ» 16:9æ¨å¥¨ ãƒ» 500MBæœªæº€</div>
                </div>
            </div>

            <div class="row">
                <div>
                    <label for="name">æ°åï¼ˆCreator Nameï¼‰</label>
                    <input id="name" type="text" placeholder="ä¾‹ï¼šDaijiro Majima">
                </div>
                <div>
                    <label for="company">ä¼šç¤¾åï¼ˆCompanyï¼‰</label>
                    <input id="company" type="text" placeholder="ä¾‹ï¼šTOPPAN Inc.">
                </div>
            </div>

            <div class="row">
                <div>
                    <label for="url">URL</label>
                    <input id="url" type="text" placeholder="https://example.com">
                </div>
                <div>
                    <label for="videoTitle">å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä»»æ„ï¼‰</label>
                    <input id="videoTitle" type="text" placeholder="ä¾‹ï¼šSpace-CX Showreel">
                </div>
            </div>

            <div style="margin-top:10px;">
                <label for="summary">æ¦‚è¦ / ã‚³ãƒ¡ãƒ³ãƒˆ</label>
                <textarea id="summary" placeholder="ã“ã®å‹•ç”»ã‚„ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã«ã¤ã„ã¦ã®ç°¡å˜ãªèª¬æ˜"></textarea>
            </div>

            <div style="margin-top:10px;">
                <label>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒï¼ˆä»»æ„ï¼‰</label>
                <div class="btns" style="margin-top:6px;">
                    <label class="btn" style="position:relative;overflow:hidden;">
                        ç”»åƒã‚’é¸æŠ
                        <input id="profileInput" type="file" accept="image/*"
                            style="position:absolute;inset:0;opacity:0;cursor:pointer;">
                    </label>
                    <span class="hint" id="profileHint">æœªé¸æŠ</span>
                </div>
            </div>

            <div class="btns">
                <button class="btn primary" id="saveBtn">ä¿å­˜ / è¿½åŠ </button>
                <button class="btn" id="clearBtn">å…¥åŠ›ã‚¯ãƒªã‚¢</button>
            </div>
            <p class="hint">â€» ç·¨é›†ãƒ»å‰Šé™¤ã¯ç®¡ç†è€…ã®ã¿ã€‚å…¨å‰Šé™¤ã¯Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰è¡Œã£ã¦ãã ã•ã„ã€‚</p>
        </section>

        <!-- LIST -->
        <section class="glass">
            <h2>CREATOR LIST</h2>
            <p class="hint">ç™»éŒ²æ¸ˆã¿ã®ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ä¸€è¦§ã€‚ã‚¯ãƒªãƒƒã‚¯ã§ãƒ•ã‚©ãƒ¼ãƒ ã«èª­ã¿è¾¼ã¿ã€ä¸Šæ›¸ãä¿å­˜ã‚„å‰Šé™¤ãŒã§ãã¾ã™ã€‚ï¼ˆè¦ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³ï¼‰</p>

            <table>
                <thead>
                    <tr>
                        <th style="width:40px;">No</th>
                        <th>æ°å</th>
                        <th>ä¼šç¤¾å</th>
                        <th>URL</th>
                        <th style="width:110px;">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="tbody">
                    <tr>
                        <td colspan="5" style="text-align:center;padding:16px 0;color:#9ca3af;">ã¾ã ç™»éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</td>
                    </tr>
                </tbody>
            </table>
        </section>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAA97KPsLsnHUg5G8Rtb7-3CwMJ1oynkVs",
            authDomain: "play-create-live.firebaseapp.com",
            databaseURL: "https://play-create-live-default-rtdb.firebaseio.com",
            projectId: "play-create-live",
            storageBucket: "play-create-live.firebasestorage.app",
            messagingSenderId: "143889321354",
            appId: "1:143889321354:web:3c2d16f5fd928ba10e0c73",
            measurementId: "G-ZFHF93QQCJ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // â˜…ã“ã“ã‚’ã‚ãªãŸã®ç®¡ç†è€…ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰ãˆã‚‹
        const ADMIN_EMAIL = "mjmdjr@gmail.com";

        function $(s) { return document.querySelector(s); }

        let currentVideoFile = null;
        let currentProfileFile = null;
        let editingId = null;
        let editingEntry = null;

        function setLockState(text) {
            $('#lockState').textContent = text;
        }

        function bindDnD() {
            const dz = $('#videoDrop');
            const input = $('#videoInput');
            const hint = dz.querySelector('.hint');

            function setDrag(on) { dz.classList.toggle('dragover', !!on); }
            ['dragenter', 'dragover'].forEach(ev => {
                dz.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); setDrag(true); });
            });
            ['dragleave', 'drop'].forEach(ev => {
                dz.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); setDrag(false); });
            });

            dz.addEventListener('drop', e => {
                const files = e.dataTransfer.files;
                const f = files && files[0];
                if (f && f.type.indexOf('video/') === 0) {
                    currentVideoFile = f;
                    hint.textContent = 'å‹•ç”»èª­ã¿è¾¼ã¿ä¸­... (' + f.name + ')';
                    setTimeout(() => { hint.textContent = 'é¸æŠä¸­: ' + f.name; }, 500);
                }
            });

            input.addEventListener('change', e => {
                const files = e.target.files;
                const f = files && files[0];
                if (f && f.type.indexOf('video/') === 0) {
                    currentVideoFile = f;
                    hint.textContent = 'å‹•ç”»èª­ã¿è¾¼ã¿ä¸­... (' + f.name + ')';
                    setTimeout(() => { hint.textContent = 'é¸æŠä¸­: ' + f.name; }, 500);
                }
            });

            $('#profileInput').addEventListener('change', e => {
                const files = e.target.files;
                const f = files && files[0];
                if (f) {
                    currentProfileFile = f;
                    const ph = $('#profileHint');
                    ph.textContent = 'ç”»åƒèª­ã¿è¾¼ã¿ä¸­... (' + f.name + ')';
                    setTimeout(() => { ph.textContent = 'é¸æŠä¸­: ' + f.name; }, 500);
                }
            });
        }

        function clearForm() {
            $('#name').value = '';
            $('#company').value = '';
            $('#url').value = '';
            $('#videoTitle').value = '';
            $('#summary').value = '';
            $('#videoInput').value = '';
            $('#profileInput').value = '';
            $('#videoDrop').querySelector('.hint').textContent = 'MP4 / MOV ãƒ» 16:9æ¨å¥¨ ãƒ» 500MBæœªæº€';
            $('#profileHint').textContent = 'æœªé¸æŠ';
            currentVideoFile = null;
            currentProfileFile = null;
            editingId = null;
            editingEntry = null;
        }

        function flashSaveButton(message) {
            const btn = $('#saveBtn');
            const origText = btn.textContent;
            const origBg = btn.style.backgroundImage;
            btn.textContent = message || 'Saved!';
            btn.style.backgroundImage = 'linear-gradient(135deg,#22c55e,#16a34a)';
            setTimeout(() => {
                btn.textContent = origText;
                btn.style.backgroundImage = origBg || '';
            }, 900);
        }

        function uploadWithProgress(file, path, where) {
            return new Promise((resolve, reject) => {
                const storageRef = ref(storage, path);
                const task = uploadBytesResumable(storageRef, file);
                const indicator = document.createElement('span');
                indicator.style.fontSize = '11px';
                indicator.style.marginLeft = '8px';
                indicator.textContent = '0%';
                where.appendChild(indicator);
                task.on('state_changed',
                    snap => {
                        const pct = Math.round(snap.bytesTransferred / snap.totalBytes * 100);
                        indicator.textContent = pct + '%';
                    },
                    err => { console.error(err); reject(err); },
                    async () => {
                        const url = await getDownloadURL(task.snapshot.ref);
                        indicator.textContent = '100%';
                        resolve(url);
                    }
                );
            });
        }

        async function renderList() {
            const tbody = $('#tbody');
            tbody.innerHTML = '';
            const q = query(collection(db, 'creators'), orderBy('createdAt', 'desc'));
            const snap = await getDocs(q);
            if (snap.empty) {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.colSpan = 5;
                td.style.textAlign = 'center';
                td.style.padding = '16px 0';
                td.style.color = '#9ca3af';
                td.textContent = 'ã¾ã ç™»éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚';
                tr.appendChild(td);
                tbody.appendChild(tr);
                return;
            }
            let index = 1;
            snap.forEach(docSnap => {
                const it = docSnap.data();
                const tr = document.createElement('tr');
                tr.innerHTML =
                    '<td>' + index + '</td>' +
                    '<td>' + (it.name || '') + '</td>' +
                    '<td>' + (it.company || '') + '</td>' +
                    '<td style="max-width:220px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">' + (it.url || '') + '</td>' +
                    '<td>' +
                    '<button class="btn" data-edit="' + docSnap.id + '" style="padding:4px 8px;font-size:11px;">ç·¨é›†</button> ' +
                    '<button class="btn danger" data-delete="' + docSnap.id + '" style="padding:4px 8px;font-size:11px;">å‰Šé™¤</button>' +
                    '</td>';
                tbody.appendChild(tr);
                index++;
            });
        }

        async function handleRowClick(e) {
            const editId = e.target.getAttribute('data-edit');
            const delId = e.target.getAttribute('data-delete');
            if (editId) {
                const q = query(collection(db, 'creators'), orderBy('createdAt', 'desc'));
                const snap = await getDocs(q);
                snap.forEach(docSnap => {
                    if (docSnap.id === editId) {
                        const it = docSnap.data();
                        editingId = editId;
                        editingEntry = it;
                        $('#name').value = it.name || '';
                        $('#company').value = it.company || '';
                        $('#url').value = it.url || '';
                        $('#videoTitle').value = it.videoTitle || '';
                        $('#summary').value = it.summary || '';
                        $('#profileHint').textContent = it.profileImageUrl ? 'æ—¢å­˜ç”»åƒã‚ã‚Š' : 'æœªé¸æŠ';
                    }
                });
            } else if (delId) {
                if (!confirm('ã“ã®ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
                await deleteDoc(doc(db, 'creators', delId));
                await renderList();
            }
        }

        function saveEntry() {
            const user = auth.currentUser;
            if (!user) {
                alert('ä¿å­˜ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚');
                return;
            }
            if (user.email !== ADMIN_EMAIL) {
                alert('ç·¨é›†æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰ã€‚');
                return;
            }

            const saveBtn = $('#saveBtn');
            const origText = saveBtn.textContent;
            saveBtn.textContent = 'ä¿å­˜ä¸­...';
            saveBtn.disabled = true;
            saveBtn.style.opacity = '0.7';

            (async function () {
                try {
                    const name = $('#name').value.trim();
                    const company = $('#company').value.trim();
                    const url = $('#url').value.trim();
                    const videoTitle = $('#videoTitle').value.trim();
                    const summary = $('#summary').value.trim();
                    if (!name) {
                        alert('æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                        return;
                    }

                    let videoUrl = editingEntry && editingEntry.videoUrl ? editingEntry.videoUrl : null;
                    let profileUrl = editingEntry && editingEntry.profileImageUrl ? editingEntry.profileImageUrl : null;

                    const basePath = 'creators/' + Date.now() + '-' + Math.random().toString(36).slice(2);

                    if (currentVideoFile) {
                        const dz = $('#videoDrop');
                        videoUrl = await uploadWithProgress(currentVideoFile, basePath + '/video', dz);
                    } else if (!editingEntry) {
                        alert('ãƒ¡ã‚¤ãƒ³å‹•ç”»ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                        return;
                    }

                    if (currentProfileFile) {
                        const ph = $('#profileHint');
                        profileUrl = await uploadWithProgress(currentProfileFile, basePath + '/profile', ph);
                    }

                    const payload = {
                        name,
                        company,
                        url,
                        videoTitle,
                        summary,
                        profileImageUrl: profileUrl || null,
                        videoUrl: videoUrl || null,
                        likes: editingEntry && typeof editingEntry.likes === "number" ? editingEntry.likes : 0,
                        createdAt: editingEntry && editingEntry.createdAt ? editingEntry.createdAt : Date.now()
                    };

                    if (editingId) {
                        await updateDoc(doc(db, 'creators', editingId), payload);
                    } else {
                        await addDoc(collection(db, 'creators'), payload);
                    }

                    clearForm();
                    await renderList();
                    flashSaveButton(editingId ? 'æ›´æ–°ã—ã¾ã—ãŸ' : 'ä¿å­˜ã—ã¾ã—ãŸ');
                } catch (e) {
                    console.error(e);
                    alert('ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                } finally {
                    saveBtn.disabled = false;
                    saveBtn.style.opacity = '1';
                    saveBtn.textContent = origText;
                }
            })();
        }

        function setupLogin() {
            const overlay = $('#loginOverlay');
            const emailEl = $('#loginEmail');
            const passEl = $('\#loginPassword');
            const btn = $('\#loginButton');
            const err = $('\#loginError');

            const passInput = $('#loginPassword');
            const loginBtn = $('#loginButton');

            loginBtn.addEventListener('click', () => {
                const email = emailEl.value.trim();
                const pass = passInput.value;
                if (!email || !pass) {
                    err.textContent = 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                    return;
                }
                err.textContent = '';
                loginBtn.disabled = true;
                loginBtn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...';
                signInWithEmailAndPassword(auth, email, pass)
                    .then(() => {/* onAuthStateChangedã§å‡¦ç† */ })
                    .catch(e => {
                        console.error(e);
                        err.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
                    })
                    .finally(() => {
                        loginBtn.disabled = false;
                        loginBtn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
                    });
            });
        }

        (function init() {
            bindDnD();
            setupLogin();

            onAuthStateChanged(auth, user => {
                const overlay = $('#loginOverlay');
                if (!user) {
                    overlay.style.display = 'flex';
                    setLockState('ğŸ”’ Locked');
                    return;
                }
                if (user.email !== ADMIN_EMAIL) {
                    overlay.style.display = 'flex';
                    setLockState('ğŸ”’ Locked');
                    alert('ã“ã®ç·¨é›†ç”»é¢ã¯ç®¡ç†è€…å°‚ç”¨ã§ã™ã€‚TOPã¸æˆ»ã‚Šã¾ã™ã€‚');
                    signOut(auth).then(() => { window.location.href = 'index.html'; });
                    return;
                }
                overlay.style.display = 'none';
                setLockState('ğŸ”“ Unlocked');
                renderList();
            });

            $('#saveBtn').addEventListener('click', saveEntry);
            $('#clearBtn').addEventListener('click', clearForm);
            $('#tbody').addEventListener('click', handleRowClick);
        })();
    </script>
</body>

</html>